---
title: "Data Cleaning for AGB Analysis (Spring 2022)"
author: "Aubrey Knier & Mishka Malinowski"
date: "3/23/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
getwd()

library(tidyverse)
#install.packages("janitor")
library(janitor)

#load data
AGB.sp22.data.raw <- read.csv("Data_USE_ME.csv")
clean.spp.list <- read.csv("clean_spp_list.csv") %>%
  select(Species)

class(clean.spp.list)
```   

```{r}
#using plots: "DF3B", "DF5A", "DF5B", "DF6A", "DF6B" and "IF2A"

#exploring groups within project and plot columns
unique(AGB.sp22.data.raw$Project)
unique(AGB.sp22.data.raw$Plot)

#filter data for only our 6 plots
AGB.sp22.data <- AGB.sp22.data.raw %>%
  unite("Proj.Plot", Project:Plot, remove=F) %>%
    filter(Proj.Plot %in% c("DF_3B", "DF_5A", "DF_5B", "DF_6A", "DF_6B", "IF_2A"))

#check row names of Proj.Plot
unique(AGB.sp22.data$Proj.Plot) #only data for 6 plots in data frame

#subset data
colnames(AGB.sp22.data)
AGB.sp22.data.subset <- AGB.sp22.data %>%
  select(E, Date..dd.mm.yyyy..1,Proj.Plot,Grid, Plant_tag, X_coord, Y_coord, Tool, POM, DBH..mm., Height..meters.,Type_Field, Note_Field, ID, Treatment)
colnames(AGB.sp22.data.subset)
##QUESTION FOR VINCENT - What is treatment? 

#column names 
colnames(AGB.sp22.data.subset) = c("Data_Collection_Season", "Date", "Proj.Plot", "Grid", "Plant_tag", "X_Coord", "Y_Coord", "Tool", "POM", "DBH_mm", "Height_m", "Veg_Type", "Notes", "ID", "Treatment")

```

```{r}
#### CHECKING COLUMNS ####

#Check Date Column 
class(AGB.sp22.data.subset$Date)
unique(AGB.sp22.data.subset$Date)

AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("3/13/21")] <- "13/03/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("3/14/21")] <- "14/03/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("3/15/21")] <- "15/03/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("3/16/21")] <- "16/03/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("1/12/21")] <- "1/12/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("3/12/21")] <- "3/12/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("2/12/21")] <- "2/12/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("6/12/21")] <- "6/12/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("5/12/21")] <- "5/12/2021"
AGB.sp22.data.subset$Date[AGB.sp22.data.subset$Date %in% c("4/12/21")] <- "4/12/2021"

unique(AGB.sp22.data.subset$Date)

AGB.sp22.data.subset$Date <- as.Date(AGB.sp22.data.subset$Date,
                                     format = "%d/%m/%Y")
class(AGB.sp22.data.subset$Date)
unique(AGB.sp22.data.subset$Date)
summary(AGB.sp22.data.subset$Date)

#Data_Collection_Season
unique(AGB.sp22.data.subset$Data_Collection_Season)
###QUESTION FOR VINCENT - what is the difference between Winter_2021 and Nov_Dec_2021? can you explain these data collection periods more?

#Grid
unique(AGB.sp22.data.subset$Grid)
#Found H7/J8 which is wrong 
class(AGB.sp22.data.subset$Grid)
sum(AGB.sp22.data.subset$Grid == "H7/J8")
AGB.sp22.data.subset$Grid[AGB.sp22.data.subset$Grid %in% c("H7/J8")] <- "H7/I8"

#Plant_tag
unique(AGB.sp22.data.subset$Plant_tag)
TAG_NUM_ID <- AGB.sp22.data.subset %>%
  select(Proj.Plot, Grid, Plant_tag) %>%
  unite("TAG_NUM_2", Proj.Plot:Grid:Plant_tag)

Plant_tag_duplicates <- TAG_NUM_ID %>% group_by(TAG_NUM_2) %>% summarise(n=sum(n())) %>% filter(n>1)
##Well.... even with the most unique identifier we find 1,683 duplicates... so perhaps there was an error with data entry... either in the field or transfering between paper and database

#X_coord 
summary(AGB.sp22.data.subset$X_Coord)
#Looks ok weird that it goes above 5m, but ok 
#why 77 NAs? 
which(is.na(AGB.sp22.data.subset$X_Coord), arr.ind=TRUE)

#Y_coord 
summary(AGB.sp22.data.subset$Y_Coord)
#Looks weirder max at 7...?
which(is.na(AGB.sp22.data.subset$Y_Coord), arr.ind=TRUE)
which(AGB.sp22.data.subset$Y_Coord > "5.0")
#80 NAs
which(is.na(AGB.sp22.data.subset$Y_Coord), arr.ind=TRUE)

#Tool
unique(AGB.sp22.data.subset$Tool)
sum(AGB.sp22.data.subset$Tool == "")
which(AGB.sp22.data.subset$Tool == "")

#POM
summary(AGB.sp22.data.subset$POM)
#seems reasonable but the 154 NAs are meh 

#DBH_mm
summary(AGB.sp22.data.subset$DBH_mm)
#the largest is 2600mm is this reasonable? 
#19 NAs will need to take out then to properly clean 

#Height_mm
summary(AGB.sp22.data.subset$Height_m)
#NAs ok can make model 
class(AGB.sp22.data.subset$Height_m)
nrow(AGB.sp22.data.subset[AGB.sp22.data.subset$Height_m <1.5,])
#should we remove the little ones? They are just taken from the quadrats where we did the little plant sampling.

#Veg_Type
unique(AGB.sp22.data.subset$Veg_Type)
AGB.sp22.data.subset$Veg_Type[AGB.sp22.data.subset$Veg_Type %in% c("tree","TREE")] <- "Tree"
#What should we do about Marantaceae and HRB? 

#Notes
unique(AGB.sp22.data.subset$Notes)

#Treatment
unique(AGB.sp22.data.subset$Treatment)
#Not certain what these are still?

```

``` {r}
#Species IDs

sort(unique(AGB.sp22.data.subset$ID))
AGB.sp22.data.subset$ID[AGB.sp22.data.subset$ID %in% c("Afrostyrax lepidophloeus")] <- "Afrostyrax lepidophyllus"
AGB.sp22.data.subset$ID[AGB.sp22.data.subset$ID %in% c("Agellae paradoxa")] <- "Agelaea paradoxa"

#compare species ID in dataframe with reference species list. 1=match, 0=no match
AGB.sp22.data$Spp.match <- 
  

  
  ifelse(AGB.sp22.data$ID %in% clean.spp.list, 1,0)

unique(AGB.sp22.data$Spp.match)
```
